---
  - name: Build multi-vendor docs
    hosts: localhost
    connection: local
    gather_facts: no

    vars_files:
      - variables.yml

    tasks:

      - name: Create Index
        template: src=templates/index.tmpl dest=docs/index.rst

      - name: Create Introduction
        template: src=templates/intro.tmpl dest=docs/intro.rst

      - name: Create About
        template: src=templates/about.tmpl dest=docs/about.rst

      - name: Create FAQ
        template: src=templates/faq.tmpl dest=docs/faq.rst

      - name: Create Module Index
        template: src=templates/modules.tmpl dest=docs/modules.rst

      - name: Link Modules to Index
        lineinfile:
          dest: docs/modules.rst
          line: '   {{ item.name }}<{{ item.name }}/modules_list>'
        with_items: libraries

      - name: Get Ansible Repos
        git: repo={{ item.url }} dest=repos/{{ item.url | basename }} update=yes
        with_items: libraries

      - name: Make Ansible Docs
        docgen:
          module_dir: repos/{{ item.url | basename }}/{{ item.path }}
          output_dir: docs/{{ item.name }}
          make_index: false
          modules_title: "{{ item.name }}"
        with_items: libraries

#    - name: Link Docs to Index
#      lineinfile:
#        dest: docs/{{ item.key }}/vendor_page.rst
#        line: '   {{ item.value.ansible_modules.name }}<{{ item.value.ansible_modules.name }}/modules_list>'
#      with_dict: vendors
#      when: "{{ 'ansible_modules' in item.value }} "
#
#    - name: Create Index File
#      template: src=templates/index.tmpl dest=docs/index.rst
#
      - name: Make Clean
        command: /usr/bin/make clean chdir=docs/

      - name: Make HTML
        command: /usr/bin/make html chdir=docs/

